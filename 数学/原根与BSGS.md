# 原根与BSGS

## 原根
> 推荐阅读 《训练指南》(蓝书) 

对于整数 $m$, 如果存在整数 $a$ $(1 \leq a < m)$ 使得 $a^{1}, a^{2}, a^{3}..., a^{m - 1}$ 模 $m$ 的值取遍 $1, 2, ..., m - 1$。那么 $a$ 就是 $m$ 的一个原根。

### 性质
1. $a^{1}, a^{2}, a^{3}...$ 模 $m$ 的取值会出现循环，根据欧拉定理， $a^{\varphi(m)} \equiv 1 \quad(\bmod m)$, 当 $m$ 是质数时， $a^{m - 1} \equiv 1 \quad(\bmod m)$，所以在出现 $1$ 之前不会有循环。出现 $1$ 后立刻开始循环。即原根循环节长度是 $m - 1$。
2. 原根有 $\varphi(\varphi(m))$ 个。
3. **原根不只是质数才有**， $2,4, p^{n}, 2 p^{n}$ ( $p$ 是奇质数) 都有原根。
4. 一个数的最小原根不多于 $m ^ {0.25}$ 级别。
5. 一个数的原根一定与它互质，因为不互质就没有循环节了。


### 求一个数 $m$ 的最小原根

方法:
1. 从小到大暴力枚举 $i$，判断 $i$ 是不是原根。
2. 判断一个数 $i$ 是不是 $m$ 的原根：
	1. 判断 $gcd(i, m)$ 是否等于 $1$. (原根和 $m$ 必须互质)
	2. 枚举 $\varphi(m)$ 的每一个真因子 $j$，如果 $i^{j} \equiv 1 \quad(\bmod m)$, 那么 $i$ 不是原根。(说明循环节小了)
	3. 实际上只需要枚举质因子就可以得到所有真因子的倍数。

### 求一个数 $m$ 的所有原根

原理：假设最小原根是 $g$, 一个数的所有原根都是 $g^k$ 形式。并且需要满足 $\gcd(k, \varphi(m)) = 1$ (由此可以知道原根有 $\varphi(\varphi(m))$ 个)

方法:
1. 求出最小原根 $g$。
2. 枚举 $k$ $(1\leq k \leq \varphi(m))$, 如果 $\gcd(k, \varphi(m)) = 1$， 那么 $g^{k} \% m$ 就是一个原根。 

		
## BSGS

### 指标
$g^{I(x)} \equiv x \mod p$, $I(x)$ 是指标，也是离散对数。

### 一般离散对数的求解方法 BSGS
朴素 BSGS 复杂度: $O(\sqrt n)$ 

- 求解 $a^{x} \equiv b \quad(\bmod p)$ : 

	$$x=A\lceil\sqrt{p}\rceil-B (0 \leq A, B \leq\lceil\sqrt{p}\rceil)$$
	$$a^{A\lceil\sqrt{p}\rceil-B} \equiv b(\bmod p)$$
	$$a^{A\lceil\sqrt{p}\rceil} \equiv b a^{B}(\bmod p)$$
  预处理 $b a^{B}$ 的所有取值，然后枚举 $A$。用 hash 或者 map 判断是否存在相等的 $b a^{B}$

- 求 $x^{a} \equiv b \quad(\bmod p)$ : 

	用原根表示 $x = g ^ {c}$, 求离散对数即可。
	
### 原根指标的求解方法

求解， $g ^ x \equiv a \mod p$ 

1. 先求出 $a$ 的最小循环结 $c$, 即 $a ^ c \equiv 1 \mod p$，枚举 $\phi(p)$ 的因数即可。 注意: $1e9$ 级别的数字的因数个数在 $1e3$ 级别。
2. $g^x \equiv a \mod p$ 所以 $g^{xc} \equiv 1 \mod p$, 又因为 $g^{\phi(p)} \equiv 1 \mod p$, 所以 $x = \frac{\phi(p)}{c}$。

这种方法需要预处理 $\phi(p)$ 所有的因数，但因为因数个数很少，所以在查询的时候速度很快。复杂度 $O(\phi(p)的因数个数)$， 请注意因数个数很少。（根据反质数性质)





