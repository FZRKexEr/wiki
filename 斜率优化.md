# 斜率优化

把 DP 问题转化成求直线最小截距问题。

常见形式是 DP 转移方程里面有一个形如 $(i - j)^{2}$ 的东西。

## 处理手段 

假设当前要求 $dp(i)$, 已知很多个 $dp(j)$。那么，写出转移方程，把方程里面只涉及 $i$ 的部分看成 $y = k \cdot x + b$ 中的 $b$。同时涉及 $i$ 和 $j$ 的部分看成 $k \cdot x$，只涉及 $j$ 的部分看成 $y$。不难看出，每一个 $dp(j)$ 都可以视作一个点，我们要求 $dp(i)$ 的最小值，等价于选择一个点，求过这个点的直线的截距最小。显然可以构成答案的点一定是凸包上的点。

所以我们需要做的，就是不断的往凸包里加点，查询对于某个斜率 $k$ （和 $i$ 有关），凸包中哪个点可以使得截距最小。

这里需要利用凸包的一个性质：在凸包的下凸壳中，相邻两点的斜率是单调的。所以我们只需要维护好凸包里有哪些点，然后二分就可以得到答案（如果查询的 $k$ 也是单调的，还可以用单调队列 $O(n)$ 维护）。

## 复杂度

如果查询的 $k$ 是单调的，可以优先队列 $O(n)$ 维护。否则二分 $O(n\log n)$

